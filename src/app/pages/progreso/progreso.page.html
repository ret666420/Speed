<app-header title="Mi Progreso"></app-header>

<ion-content [fullscreen]="true">

  <div class="progreso-container">

    <div *ngIf="isLoading" class="ion-padding ion-text-center">
      <ion-spinner color="warning"></ion-spinner>
      <p style="color: #666;">Analizando tu progreso...</p>
    </div>

    <div *ngIf="!isLoading && profileData" class="animate-fadeIn">

      <div class="section-header">
        <div class="icon-wrapper">
          <ion-icon name="trending-up-outline"></ion-icon>
        </div>
        <span class="section-title">Nivel de Corredor</span>
      </div>

      <div class="card progress-card">
        <div class="level-info">
          <h3>Nivel {{ currentLevel }}</h3>
          <p>{{ currentXp | number }} / {{ nextLevelXp | number }} XP (Monedas)</p>
        </div>

        <div class="progress-bar-container">
          <div class="progress-bar">
            <div class="fill" [style.width.%]="levelProgress * 100"></div>
          </div>
        </div>
      </div>

      <div class="section-header">
        <div class="icon-wrapper">
          <ion-icon name="bar-chart-outline"></ion-icon>
        </div>
        <span class="section-title">Estadísticas Globales</span>
      </div>

      <div class="stats-grid">
        <div class="stat-box">
          <h3>{{ profileData.user.races_played }}</h3>
          <small>Carreras</small>
        </div>

        <div class="stat-box">
          <h3>{{ profileData.user.total_cars }}</h3>
          <small>Coches</small>
        </div>

        <div class="stat-box">
          <h3>{{ profileData.user.maps_completed }}</h3>
          <small>Mapas</small>
        </div>

        <div class="stat-box">
          <h3>{{ profileData.records.length }}</h3>
          <small>Récords</small>
        </div>
      </div>

      <div class="section-header">
        <div class="icon-wrapper">
          <ion-icon name="lock-closed-outline"></ion-icon>
        </div>
        <span class="section-title">Próximos Retos</span>
      </div>

      <div *ngIf="lockedTrophies.length === 0" class="ion-text-center" style="color: #888; padding: 20px;">
        ¡Increíble! Has completado todos los logros.
      </div>

      <div class="card weekly-card" *ngFor="let trophy of lockedTrophies">
        <div class="mission-info">
          <h4>{{ trophy.name }}</h4>
          <small>{{ trophy.description }}</small>
        </div>
        <div class="mini-bar">
          <div class="mini-fill" style="width: 0%;"></div>
        </div>
      </div>

      <div class="section-header">
        <div class="icon-wrapper">
          <ion-icon name="trophy-outline"></ion-icon>
        </div>
        <span class="section-title">Completados Recientemente</span>
      </div>

      <div *ngIf="unlockedTrophies.length === 0" class="ion-text-center" style="color: #888; padding: 20px;">
        Aún no tienes logros. ¡Sigue jugando!
      </div>

      <div class="card mission-card" *ngFor="let trophy of unlockedTrophies">
        <div class="mission-info">
          <h4 style="color: var(--ion-color-warning);">{{ trophy.name }}</h4>
          <small>Recompensa: ${{ trophy.reward_monedas }}</small>
        </div>
        <div class="mini-bar">
          <div class="mini-fill" style="width: 100%;"></div>
        </div>
      </div>

    </div>

  </div>
</ion-content>