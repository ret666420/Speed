<app-header title="Mi perfil"></app-header>

<ion-content [fullscreen]="true" style="--background: #0f0f0f;">

  <div *ngIf="isLoading" class="ion-padding ion-text-center">
    <ion-spinner color="warning"></ion-spinner>
    <p style="color: #666;">Sincronizando perfil...</p>
  </div>

  <div *ngIf="!isLoading && profileData">

    <div class="profile-header">
      <div class="avatar">
        {{ getInitials(profileData.user.display_name) }}
      </div>
      <div>
        <h2 class="username">{{ profileData.user.display_name }}</h2>
        <p class="level">Nivel {{ userLevel }} â€¢ {{ profileData.user.username }}</p>
      </div>
    </div>

    <div class="stats-grid">
      <!-- Monedas -->
      <div class="stat-card">
        <div class="icon-box">
          <ion-icon name="cash-outline"></ion-icon>
        </div>
        <h3>Monedas</h3>
        <p class="value">{{ profileData.user.monedas | number }}</p>
      </div>

      <div class="stat-card">
        <div class="icon-box">
          <ion-icon name="flag-outline"></ion-icon>
        </div>
        <h3>Carreras</h3>
        <p class="value">{{ profileData.user.races_played }}</p>
      </div>

      <div class="stat-card">
        <div class="icon-box">
          <ion-icon name="car-sport-outline"></ion-icon>
        </div>
        <h3>Coches</h3>
        <p class="value">{{ profileData.user.total_cars }}</p>
      </div>

      <div class="stat-card">
        <div class="icon-box">
          <ion-icon name="map-outline"></ion-icon>
        </div>
        <h3>Mapas</h3>
        <p class="value">{{ profileData.user.maps_completed }}</p>
      </div>
    </div>

    <div class="section-title">Mis Logros</div>

    <div class="achievement-card" *ngFor="let trophy of profileData.trophies"
      [style.opacity]="trophy.achieved ? '1' : '0.5'">
      <div class="row">
        <div>
          <h4 style="display: flex; align-items: center; gap: 8px;">
            <ion-icon [name]="trophy.achieved ? 'trophy' : 'lock-closed'"
              [color]="trophy.achieved ? 'warning' : 'medium'"></ion-icon>
            {{ trophy.name }}
          </h4>
          <p>{{ trophy.description }}</p>
        </div>

        <span class="percent" [style.color]="trophy.achieved ? 'var(--ion-color-warning)' : '#666'">
          {{ trophy.achieved ? 'DESBLOQUEADO' : 'BLOQUEADO' }}
        </span>
      </div>

      <div class="progress-bar">
        <div class="fill" [style.width]="trophy.achieved ? '100%' : '0%'"></div>
      </div>
    </div>

  </div>

</ion-content>